<!--     
										    __                        __     ______                         __                      
										   / /   ___  _   __  ___    / /    / ____/   _____  ___   ____ _  / /_  ___    _____       
										  / /   / _ \| | / / / _ \  / /    / /       / ___/ / _ \ / __ `/ / __/ / _ \  / ___/       
										 / /___/  __/| |/ / /  __/ / /    / /___    / /    /  __// /_/ / / /_  /  __/ / /           
										/_____/\___/ |___/  \___/ /_/     \____/   /_/     \___/ \__,_/  \__/  \___/ /_/           

-->

<!DOCTYPE html>
<html>
<head>
	<title>Level Creater</title>
	<style>
		canvas {
			display: block;
			margin: 0 auto;
			background-color: #ecf0f1;
			border: 1px solid #000;
			width: 960px;
			height: 540px;
		}
		.selections {
			width: 960px;
			display:block;
			margin:0 auto;
			margin-bottom:20px;
			margin-top:20px;
		}
		.selections div {
			float:left;
		}
		.selections #actions {
			margin-right: 20px;
		}
	</style>
</head>

<body onload="startGame()">

<div class="selections">
	<!-- <img src="../assets/big_block_bg.jpg">
	<img src="../assets/small_block_bg.jpg">
	<img src="../assets/wall_bg.png"> -->
	<form name="placement_form">
		<div id="actions">
			<input type="radio" name="action" value="place" checked> Place Blocks <br/>
			<input type="radio" name="action" value="erase"> Erase <br/>
			<input type="button" value="Clear" onclick="clearCanvas()">
		</div>
		<div id="block_types">
			<input type="radio" name="types" value="big"> Big Block <br/>
			<input type="radio" name="types" value="small"> Small Block <br/>
			<input type="radio" name="types" value="wall"> Wall
		</div>
	</form>
	<div style="clear:both;"></div>
</div>

<div style="clear:both;"></div>

<canvas id="game" width="960px" height="540px"></canvas>
	<div class="selections">
	<input type="button" name="generate" value="generate" onclick="printCode()">
	<pre id="code"></pre>
</div>

<img src="assets/wall_bg.png" id="wall_bg" style="display:none;" >

<!-- <script src="../js/GLOBALS.js"></script> -->
<!-- <script src="js/creater.js"></script> -->
<!-- <script src="../js/gamePieces.js"></script> -->
<script src="js/lc_blockPlacement.js"></script>
<script src="js/lc_wallPlacement.js"></script>
<script src="js/lc_eraseBlocks.js"></script>
<script>
	
var mousePos = {
	x : 0,
	y : 0,
	down : false
};

var width = 960;
var height = 540;
var bottom_bound = height - 35;

//helps control placing the current block based on all of the other blocks
//centering vertically and horizontally based on the center point of other blocks
var placement_guides = {
	forced_placement : {
		x : null,
		y : null
	},
	vertical_centering : false,		//vertically align with another block
	horizontal_centering : false,	//horizontally align with another block
	c_vertical_centering : false,	//vertically align with the canvas
	c_horizontal_centering: false,	//horizontally align with the canvas
	hugging_tb : false,				//align with the top/bottom edge of another block
	hugging_lr : false 				//align with the left/right edge of another block
}

//placement objects that hint to the user what kind of block they are placing
var BIG_BLOCK_DIMENSIONS = { width : 75, height : 35 };
var SMALL_BLOCK_DIMENSIONS = { width : 75, height : 35 / 2 };
var BIG_BLOCK_IMAGE = "assets/big_block_bg.jpg";
var SMALL_BLOCK_IMAGE = "assets/small_block_bg.jpg";
var PLACEMENT_BIG_BLOCK, PLACEMENT_SMALL_BLOCK, PLACEMENT_WALL;

//holds all of the assets for each type of block that can be placed
var block_assets = {
	big : {
		"green" : "assets/big_block_bg.jpg"
	},

	small : {
		"green" : "assets/small_block_bg.jpg"
	},

	wall : "assets/wall_bg.png"
}

//an array to display all of the blocks that have been placed
var test_blocks = [];

//holds keys that are being pressed
var pressed_buttons = {};
var deleted_blocks = [];

//holds information about the block that is to be placed
var selection = {
	place : true,
	erase : false,
	blocks : {
		big : false,
		small : false,
		wall : false
	},
	color : "green"
}

var SCENES = {
	place : blockPlacementScene,
	erase : eraseBlocksScene,
	wall : wallPlacementScene
}

var active_block; //keeps track of the block that is currently being placed
var ACTIVE_SCENE = SCENES.place;

//holds all of the level data entered by the user
var level_object = {
	bonuses : {
		time_lower_bound : 60,
		timer_upper_bound : 90,
		paddle_lower_bound : 20,
		paddle_upper_bound : 40
	},

	blocks : []
}

function startGame() {
	PLACEMENT_BIG_BLOCK = new block( BIG_BLOCK_DIMENSIONS.width, BIG_BLOCK_DIMENSIONS.height, BIG_BLOCK_IMAGE, -BIG_BLOCK_DIMENSIONS.width, -BIG_BLOCK_DIMENSIONS.height, 1, "image" );
	PLACEMENT_SMALL_BLOCK = new block( SMALL_BLOCK_DIMENSIONS.width, SMALL_BLOCK_DIMENSIONS.height, SMALL_BLOCK_IMAGE, 100, -SMALL_BLOCK_DIMENSIONS.height, 1, "image" );
	PLACEMENT_WALL = new block( SMALL_BLOCK_DIMENSIONS.width, SMALL_BLOCK_DIMENSIONS.height, SMALL_BLOCK_IMAGE, 100, -SMALL_BLOCK_DIMENSIONS.height, 1, "image" );
	active_block = new block( 0, 0, "rgba(0,0,0,0)", 100, 0, 0, "color" );

	SCENES.wall.setup();

	myGameArea.start( );
}

function block(  ) {

}

var myGameArea = {
    canvas : document.getElementById("game"),

    start : function() {
    	this.canvas.width = width;
    	this.canvas.height = height;
        this.context = this.canvas.getContext("2d");
        this.interval = setInterval( updateGameArea, 20 );

    	//canvas event listeners
        window.addEventListener('keydown', function(e) {
        	//send the keyup event to the active scene 
        	pressed_buttons[ e.keyCode ] = true;
        	ACTIVE_SCENE.buttonPress( e );
        	// //ctrl-z == 17 && 90
        	// if ( pressed_buttons[17] && pressed_buttons[90] )  {
        	// 	if ( test_blocks.length >= 0 ) {
	        // 		test_blocks.pop();
	        // 		deleted_blocks.push( level_object.blocks[ level_object.blocks.length - 1 ] );
	        // 		level_object.blocks.pop();
	        // 	}
        	// }     	
        	// //ctrl-y == 17 && 90
        	// else if ( pressed_buttons[17] && pressed_buttons[89] ) {
        	// 	if ( deleted_blocks.length >= 0 ) {
	        // 		var blk = deleted_blocks.pop();
	        // 		level_object.blocks.push( blk );
	        // 		//width, height, color, x, y, health = 1, type = "color"
	        // 		test_blocks.push( new block( blk.width, blk.height, blk.src, blk.x, blk.y, blk.health, "image" ) );
	        // 	}
        	// }
        })

        window.addEventListener('keyup', function( e ){
        	//send the keyup event to the active scene
        	pressed_buttons[ e.keyCode ] = false;
        })

        this.canvas.addEventListener('mousedown', function( e ) {
        	//send the click event to the active scene
        	//alert( JSON.stringify( placement_guides, undefined, 4 ) );
        	ACTIVE_SCENE.click_down( e );
        })

        this.canvas.addEventListener('mouseup', function( e ) {
        	//send the click event to the active scene
        })
    },

    clear : function() {
    	this.context.clearRect( 0, 0, this.canvas.width, this.canvas.height );
    }
}

function updateGameArea() {
	myGameArea.clear();
	var ctx = myGameArea.canvas.getContext("2d");

	ACTIVE_SCENE.run();

	myGameArea.context.save();
	myGameArea.context.globalAlpha = 0.4;
	PLACEMENT_BIG_BLOCK.update();
	PLACEMENT_SMALL_BLOCK.update();
	PLACEMENT_WALL.update();
	myGameArea.context.restore();

	for ( var i = 0; i < test_blocks.length; ++i ) {
		test_blocks[i].update();
	}

	//Bottom bound
	ctx.setLineDash([5, 3]);/*dashes are 5px and spaces are 3px*/
	ctx.beginPath();
	ctx.moveTo(0,height - 75);
	ctx.lineTo(width, height - 75);
	ctx.strokeStyle = '#ff0000';
	ctx.stroke();

}

function getMousePos(canvas, e) {
    var rect = document.getElementById("game").getBoundingClientRect();
    return {
    	x: e.clientX - rect.left,
    	y: e.clientY - rect.top
	};
}

document.getElementById("game").addEventListener('mousemove', function(e) {
	mousePos = getMousePos(document.getElementById("game"), e);
    //myPaddle.newPos( mousePos.x, mousePos.y );
}, false);

function block( width, height, color, x, y, health = 1, type = "color" ) {
	this.width = width;
	this.height = height;
	this.spdX = 0;
	this.spdY = 0;
	this.x = x;
	this.y = y;
	this.is_wall = false;
	this.health = health;
	if ( type == "image" ) {
		this.image = new Image();
		this.image.src = color;
	}

	this.center = {
		x : this.x + ( this.width / 2 ),
		y : this.y + ( this.height / 2 )
	}

	//edges
	this.top_edge = this.y;
	this.bottom_edge = this.top_edge + this.height;
	this.left_edge = this.x;
	this.right_edge = this.left_edge + this.width;

	this.update = function() {
		ctx = myGameArea.context;
		if ( type == "color" ) {
			ctx.fillStyle = color;
			ctx.fillRect( this.x, this.y, this.width, this.height );
		} else if ( this.is_wall ) {
			ctx.beginPath();
		    //ctx.clearRect(0, 0, width, height); 
		    var img = document.getElementById("wall_bg")
		    var pat = ctx.createPattern(img, "repeat-x");
		    ctx.fillStyle = pat;
		    ctx.save();
		    ctx.translate( this.x, this.y );
		    ctx.fillRect(0, 0, this.width, this.height);
		    ctx.restore();
		    //ctx.translate( this.x, this.y );
		    //ctx.fill();
		}
		else /*( type == "image" )*/ {
			ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
		}
		//edges
		this.top_edge = this.y;
		this.bottom_edge = this.top_edge + this.height;
		this.left_edge = this.x;
		this.right_edge = this.left_edge + this.width;
		this.center.x = this.x + ( this.width / 2 );
		this.center.y = this.y + ( this.height / 2 );
	}
}

function placement_code( width, height, src, x, y, type, health = 1 ){
	this.type = type; //big_block, small_block, wall
	this.x = x,
	this.y = y,
	this.width = width,
	this.height = height,
	this.src = src,
	this.health = health
}

var rad = document.placement_form.types;
var prev = null;
for(var i = 0; i < rad.length; i++) {
    rad[i].onclick = function() {
        (prev)? selection.blocks[prev.value] = false : null;
        //console.log( this.value );
        //selection.blocks[prev.value] = false;
        if(this !== prev) {
            prev = this;
        }
        selection.blocks[prev.value] = true;
        ///console.log( prev.value );

	    if ( ACTIVE_SCENE === SCENES.place ) {
	        if ( prev.value == "big" ) {
	        	active_block = PLACEMENT_BIG_BLOCK;
	        } else if ( prev.value == "small" ) {
	        	active_block = PLACEMENT_SMALL_BLOCK;
	        } else if ( prev.value == "wall" ) {
	    		ACTIVE_SCENE = SCENES.wall;
	    	}	
	    }

        PLACEMENT_BIG_BLOCK.x = -100;
        PLACEMENT_BIG_BLOCK.y = -100;
        PLACEMENT_SMALL_BLOCK.x = -100;
        PLACEMENT_SMALL_BLOCK.y = -100;
        PLACEMENT_WALL.x = -100;
        PLACEMENT_WALL.y = -100;
    };
}

//actions
var act_rad = document.placement_form.action;
var act_prev = null;
for(var i = 0; i < act_rad.length; i++) {
    act_rad[i].onclick = function() {
        (act_prev)? selection[act_prev.value] = false : null;
        //console.log( this.value );
        //selection.blocks[act_prev.value] = false;
        if(this !== act_prev) {
            act_prev = this;
        }
        selection[act_prev.value] = true;
        ACTIVE_SCENE.blur();
        ACTIVE_SCENE = SCENES[act_prev.value];
        ///console.log( act_prev.value );
    };
}

function validPlacement( blk ) {
	if ( blk.right_edge > width || blk.left_edge < 0 || blk.top_edge < 0 || blk.bottom_edge > height ) {
		return false;
	} else {
		return true;
	}
}

function clearCanvas( ) {
	test_blocks = [];
	level_object.blocks = [];
}

function printCode() {
	document.getElementById("code").innerHTML = JSON.stringify( level_object, null, 5 );
}
</script>

</body>
</html>